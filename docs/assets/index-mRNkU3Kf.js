var A=Object.defineProperty;var E=(o,t,e)=>t in o?A(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var l=(o,t,e)=>(E(o,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const n of i.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&r(n)}).observe(document,{childList:!0,subtree:!0});function e(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=e(s);fetch(s.href,i)}})();class a{constructor(t,e){l(this,"x");l(this,"y");this.x=t,this.y=e}plus(t){return new a(this.x+t.x,this.y+t.y)}times(t){return new a(this.x*t,this.y*t)}static create(t,e){return new a(t,e)}}function C(o,t){return o.pos.x+o.size.x>t.pos.x&&o.pos.x<t.pos.x+t.size.x&&o.pos.y+o.size.y>t.pos.y&&o.pos.y<t.pos.y+t.size.y}class y{constructor(t,e,r){l(this,"level");l(this,"actors");l(this,"status");this.level=t,this.actors=e,this.status=r}get player(){return this.actors.find(t=>t.type=="player")}update(t,e){let r=this.actors.map(n=>n.update(t,this,e)),s=new y(this.level,r,this.status);if(s.status!="playing")return s;let i=s.player;if(this.level.touches(i.pos,i.size,"lava"))return new y(this.level,r,"lost");for(let n of r)n!=i&&C(n,i)&&(s=n.collide(s));return s}static start(t){return new y(t,t.startActors,"playing")}}const m={scale:20,lives:3,actors:{coin:{wobbleSpeed:8,wobbleDist:.07,size:{x:.6,y:.6}},lava:{size:{x:1,y:1}},player:{playerXSpeed:7,gravity:30,jumpSpeed:17,size:{x:.8,y:1.5}}}},{actors:{coin:g}}=m;let $=class{constructor(){l(this,"type","coin");l(this,"size",a.create(g.size.x,g.size.y))}};class x extends ${constructor(e,r,s){super();l(this,"pos");l(this,"basePos");l(this,"wobble");this.pos=e,this.basePos=r,this.wobble=s}collide(e){let r=e.actors.filter(i=>i!=this),s=e.status;return r.some(i=>i.type=="coin")||(s="won"),new y(e.level,r,s)}update(e){let r=this.wobble+e*g.wobbleSpeed,s=Math.sin(r)*g.wobbleDist;return new x(this.basePos.plus(a.create(0,s)),this.basePos,r)}static create(e){let r=e.plus(a.create(.2,.1));return new x(r,r,Math.random()*Math.PI*2)}}const{actors:{lava:L}}=m;let M=class{constructor(){l(this,"size",a.create(L.size.x,L.size.y));l(this,"type","lava")}};class h extends M{constructor(e,r,s){super();l(this,"pos");l(this,"speed");l(this,"reset");this.pos=e,this.speed=r,this.reset=s}collide(e){return new y(e.level,e.actors,"lost")}update(e,r){let s=this.pos.plus(this.speed.times(e));return r.level.touches(s,this.size,"wall")?this.reset?new h(this.reset,this.speed,this.reset):new h(this.pos,this.speed.times(-1)):new h(s,this.speed,this.reset)}static create(e,r){return r=="="?new h(e,a.create(2,0)):r=="|"?new h(e,a.create(0,2)):r=="v"?new h(e,a.create(0,3),e):new h(e,a.create(0,3),e)}}const{actors:{player:w}}=m;class O{constructor(){l(this,"type","player");l(this,"size",a.create(w.size.x,w.size.y))}}class b extends O{constructor(e,r){super();l(this,"pos");l(this,"speed");this.pos=e,this.speed=r}collide(e){return e}update(e,r,s){let i=0;s.left&&(i-=w.playerXSpeed),s.right&&(i+=w.playerXSpeed);let n=this.pos,p=n.plus(a.create(i*e,0));r.level.touches(p,this.size,"wall")||(n=p);let c=this.speed.y+e*w.gravity,u=n.plus(a.create(0,c*e));return r.level.touches(u,this.size,"wall")?s.up&&c>0?c=-w.jumpSpeed:c=0:n=u,new b(n,a.create(i,c))}static create(e){return new b(e.plus(a.create(0,-.5)),a.create(0,0))}}function B(o){switch(o){case"o":return x;case"@":return b;default:return h}}class z{constructor(t){l(this,"height");l(this,"width");l(this,"startActors");l(this,"rows");let e=t.trim().split(`
`).map(r=>[...r]);this.height=e.length,this.width=e[0].length,this.startActors=[],this.rows=e.map((r,s)=>r.map((i,n)=>["#","+","."].includes(i)?{"#":"wall","+":"lava",".":"empty"}[i]:(this.startActors.push(B(i).create(a.create(n,s),i)),"empty")))}touches(t,e,r){let s=Math.floor(t.x),i=Math.ceil(t.x+e.x),n=Math.floor(t.y),p=Math.ceil(t.y+e.y);for(let c=n;c<p;c++)for(let u=s;u<i;u++)if((u<0||u>=this.width||c<0||c>=this.height?"wall":this.rows[c][u])==r)return!0;return!1}static create(t){return new z(t)}}const I=[`
...................................
......#................#...........
......#..............=.#...........
......#.........o.o....#...........
......#.@......#####...#...........
......#####............#...........
..........#++++++++++++#...........
..........##############...........
...................................
`,`                                                    
................................................................................
................................................................................
................................................................................
................................................................................
................................................................................
................................................................................
..................................................................###...........
...................................................##......##....##+##..........
....................................o.o......##..................#+++#..........
.................................................................##+##..........
...................................#####..........................#v#...........
............................................................................##..
..##......................................o.o................................#..
..#.....................o....................................................#..
..#......................................#####.............................o.#..
..#..........####.......o....................................................#..
..#..@.......#..#................................................#####.......#..
..############..###############...####################.....#######...#########..
..............................#...#..................#.....#....................
..............................#+++#..................#+++++#....................
..............................#+++#..................#+++++#....................
..............................#####..................#######....................
................................................................................
................................................................................
`,`                                                                     
................................................................................
................................................................................
....###############################.............................................
...##.............................##########################################....
...#.......................................................................##...
...#....o...................................................................#...
...#................................................=.......................#...
...#.o........################...................o..o...........|........o..#...
...#.........................#..............................................#...
...#....o....................##########.....###################....##########...
...#..................................#+++++#.................#....#............
...###############....oo......=o.o.o..#######.###############.#....#............
.....#...............o..o.............#.......#......#........#....#............
.....#....................#############..######.####.#.########....########.....
.....#.............########..............#...........#.#..................#.....
.....#..........####......####...#####################.#..................#.....
.....#........###............###.......................########....########.....
.....#.......##................#########################......#....#............
.....#.......#................................................#....#............
.....###......................................................#....#............
.......#...............o...........................................#............
.......#...............................................o...........#............
.......#########......###.....############.........................##...........
.............#..................#........#####....#######.o.........########....
.............#++++++++++++++++++#............#....#.....#..................#....
.............#++++++++++++++++++#..........###....###...####.o.............#....
.............####################..........#........#......#.....|.........#....
...........................................#++++++++#......####............#....
...........................................#++++++++#.........#........@...#....
...........................................#++++++++#.........##############....
...........................................##########...........................
................................................................................
`,`
......................................#++#........................#######....................................#+#..
......................................#++#.....................####.....####.................................#+#..
......................................#++##########...........##...........##................................#+#..
......................................##++++++++++##.........##.............##...............................#+#..
.......................................##########++#.........#....................................o...o...o..#+#..
................................................##+#.........#.....o...o....................................##+#..
.................................................#+#.........#................................###############++#..
.................................................#v#.........#.....#...#........................++++++++++++++##..
.............................................................##..|...|...|..##............#####################...
..............................................................##+++++++++++##............v........................
...............................................................####+++++####......................................
...............................................#.....#............#######........###.........###..................
...............................................#.....#...........................#.#.........#.#..................
...............................................#.....#.............................#.........#....................
...............................................#.....#.............................##........#....................
...............................................##....#.............................#.........#....................
...............................................#.....#......o..o.....#...#.........#.........#....................
...............#######........###...###........#.....#...............#...#.........#.........#....................
..............##.....##.........#...#..........#.....#.....######....#...#...#########.......#....................
.............##.......##........#.o.#..........#....##...............#...#...#...............#....................
.....@.......#.........#........#...#..........#.....#...............#...#...#...............#....................
....###......#.........#........#...#..........#.....#...............#...#####...######......#....................
....#.#......#.........#.......##.o.##.........#.....#...............#.....o.....#.#.........#....................
++++#.#++++++#.........#++++++##.....##++++++++##....#++++++++++.....#.....=.....#.#.........#....................
++++#.#++++++#.........#+++++##.......##########.....#+++++++##+.....#############.##..o.o..##....................
++++#.#++++++#.........#+++++#....o.................##++++++##.+....................##.....##.....................
++++#.#++++++#.........#+++++#.....................##++++++##..+.....................#######......................
++++#.#++++++#.........#+++++##.......##############++++++##...+..................................................
++++#.#++++++#.........#++++++#########++++++++++++++++++##....+..................................................
++++#.#++++++#.........#++++++++++++++++++++++++++++++++##.....+..................................................
`,`
..............................................................................................................
..............................................................................................................
..............................................................................................................
..............................................................................................................
..............................................................................................................
........................................o.....................................................................
..............................................................................................................
........................................#.....................................................................
........................................#.....................................................................
........................................#.....................................................................
........................................#.....................................................................
.......................................###....................................................................
.......................................#.#.................+++........+++..###................................
.......................................#.#.................+#+........+#+.....................................
.....................................###.###................#..........#......................................
......................................#...#.................#...oooo...#.......###............................
......................................#...#.................#..........#......#+++#...........................
......................................#...#.................############.......###............................
.....................................##...##......#...#......#................................................
......................................#...#########...########..............#.#...............................
......................................#...#...........#....................#+++#..............................
......................................#...#...........#.....................###...............................
.....................................##...##..........#.......................................................
......................................#...#=.=.=.=....#............###........................................
......................................#...#...........#...........#+++#.......................................
......................................#...#....=.=.=.=#.....o......###.......###..............................
.....................................##...##..........#.....................#+++#.............................
..............................o...o...#...#...........#.....#................##v........###...................
......................................#...#...........#..............#.................#+++#..................
.............................###.###.###.###.....o.o..#++++++++++++++#...................v#...................
.............................#.###.#.#.###.#..........#++++++++++++++#........................................
.............................#.............#...#######################........................................
.............................##...........##.........................................###......................
..###.........................#.....#.....#.........................................#+++#................###..
..#.#.........................#....###....#..........................................###.................#.#..
..#...........................#....###....#######........................#####.............................#..
..#...........................#...........#..............................#...#.............................#..
..#...........................##..........#..............................#.#.#.............................#..
..#.......................................#.......|####|....|####|.....###.###.............................#..
..#................###.............o.o....#..............................#.........###.....................#..
..#...............#####.......##..........#.............................###.......#+++#..........#.........#..
..#...............o###o.......#....###....#.............................#.#........###..........###........#..
..#................###........#############..#.oo.#....#.oo.#....#.oo..##.##....................###........#..
..#......@..........#.........#...........#++#....#++++#....#++++#....##...##....................#.........#..
..#############################...........#############################.....################################..
..............................................................................................................
..............................................................................................................
`,`
..................................................................................................###.#.......
......................................................................................................#.......
..................................................................................................#####.......
..................................................................................................#...........
..................................................................................................#.###.......
..........................o.......................................................................#.#.#.......
.............................................................................................o.o.o###.#.......
...................###................................................................................#.......
.......+..o..+................................................#####.#####.#####.#####.#####.#####.#####.......
.......#.....#................................................#...#.#...#.#...#.#...#.#...#.#...#.#...........
.......#=.o..#............#...................................###.#.###.#.###.#.###.#.###.#.###.#.#####.......
.......#.....#..................................................#.#...#.#...#.#...#.#...#.#...#.#.....#.......
.......+..o..+............o..................................####.#####.#####.#####.#####.#####.#######.......
..............................................................................................................
..........o..............###..............................##..................................................
..............................................................................................................
..............................................................................................................
......................................................##......................................................
...................###.........###............................................................................
..............................................................................................................
..........................o.....................................................#......#......................
..........................................................##.....##...........................................
.............###.........###.........###.................................#..................#.................
..............................................................................................................
.................................................................||...........................................
..###########.................................................................................................
..#.........#.o.#########.o.#########.o.##................................................#...................
..#.........#...#.......#...#.......#...#.................||..................#.....#.........................
..#..@......#####...o...#####...o...#####.....................................................................
..#######.....................................#####.......##.....##.....###...................................
........#=..................=................=#...#.....................###...................................
........#######################################...#+++++++++++++++++++++###+++++++++++++++++++++++++++++++++++
..................................................############################################################
..............................................................................................................
`],{scale:f}=m;function v(o,t,...e){let r=document.createElement(o);for(let s of Object.keys(t))r.setAttribute(s,t[s]);for(let s of e)r.appendChild(s);return r}function N(o){return v("table",{class:"background",style:`width: ${o.width*f}px`},...o.rows.map(t=>v("tr",{style:`height: ${f}px`},...t.map(e=>v("td",{class:e})))))}function D(o){return v("div",{},...o.map(t=>{let e=v("div",{class:`actor ${t.type}`});return e.style.width=`${t.size.x*f}px`,e.style.height=`${t.size.y*f}px`,e.style.left=`${t.pos.x*f}px`,e.style.top=`${t.pos.y*f}px`,e}))}class T{constructor(t,e){l(this,"dom");l(this,"actorLayer");this.dom=v("div",{class:"game"},N(e)),this.actorLayer=null,t.appendChild(this.dom)}clear(){this.dom.remove()}scrollPlayerIntoView(t){let e=this.dom.clientWidth,r=this.dom.clientHeight,s=e/3,i=this.dom.scrollLeft,n=i+e,p=this.dom.scrollTop,c=p+r,u=t.player,d=u.pos.plus(u.size.times(.5)).times(f);d.x<i+s?this.dom.scrollLeft=d.x-s:d.x>n-s&&(this.dom.scrollLeft=d.x+s-e),d.y<p+s?this.dom.scrollTop=d.y-s:d.y>c-s&&(this.dom.scrollTop=d.y+s-r)}syncState(t){this.actorLayer&&this.actorLayer.remove(),this.actorLayer=D(t.actors),this.dom.appendChild(this.actorLayer),this.dom.className=`game ${t.status}`,this.scrollPlayerIntoView(t)}}function j(o){return["ArrowLeft","k"].includes(o)?"left":["ArrowRight","ñ"].includes(o)?"right":"up"}function K(o){let t=Object.create(null);function e(r){o.includes(r.key)&&(t[j(r.key)]=r.type=="keydown",r.preventDefault())}return window.addEventListener("keydown",e),window.addEventListener("keyup",e),t}const X=K(["ArrowLeft","ArrowRight","ArrowUp","k","o","ñ"]);function k(o){return new URLSearchParams(window.location.search).get(o)}function q(o,t){return isNaN(o)||o>t||o<0?(alert("Level does not exist"),0):o}function F(){const o=document.createElement("div");o.id="watch",o.textContent="00:00:00",document.getElementById("counters").appendChild(o)}const P={counter:0,init(){F(),setInterval(this.updateCounter.bind(this),1e3)},reset(){this.counter=0},updateCounter(){this.counter++;let o=Math.floor(this.counter/3600),t=Math.floor((this.counter-o*3600)/60),e=this.counter-o*3600-t*60;document.getElementById("watch").textContent=`${o.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}:${e.toString().padStart(2,"0")}`}};function G(o){const t=document.createElement("div");t.id="lives",t.textContent=`${o} lives`,document.getElementById("counters").appendChild(t)}const S={init:G,update(o){document.getElementById("lives").textContent=`${o} lives`}};function R(o){let t=null;function e(r){if(t!=null){let s=Math.min(r-t,100)/1e3;if(o(s)===!1)return}t=r,requestAnimationFrame(e)}requestAnimationFrame(e)}function Y(o,t){let e=new t(document.body,o),r=y.start(o),s=1;return new Promise(i=>{R(n=>(r=r.update(n,X),e.syncState(r),r.status=="playing"?!0:s>0?(s-=n,!0):(e.clear(),i(r.status),!1)))})}async function H(o,t){const e={lives:m.lives,level:0},r=q(Number(k("level")),o.length-1);for(P.init(),S.init(String(m.lives)),e.level=r;e.level<o.length;){let s=await Y(z.create(o[e.level]),t);s=="won"?e.level++:s=="lost"&&e.lives>1?(e.lives-=1,S.update(String(e.lives))):(e.lives=m.lives,e.level=0,S.update(String(e.lives)),alert("You've lost! Start over! :("),P.reset())}alert("You've won!")}H(I,T);
